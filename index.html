<div style="background:#050a1f; color:white; padding:30px; border-radius:15px; max-width:700px; margin:auto; font-family:sans-serif; border: 1px solid #1e3a8a;">
    <h2 style="color:#14b8a6; text-align:center;">Gerador SEDUC - v14</h2>
    
    <label style="font-size:11px;">LINK DA PLANILHA</label>
    <input type="text" id="link" style="width:100%; padding:10px; margin-bottom:10px; background:#0f172a; border:1px solid #334155; color:white; border-radius:5px;">
    
    <div style="display:flex; gap:10px; margin-bottom:20px;">
        <input type="text" id="aba" value="BASE A" style="flex:2; padding:10px; background:#0f172a; border:1px solid #334155; color:white;">
        <button onclick="carregar()" style="flex:1; background:#14b8a6; color:#050a1f; font-weight:bold; cursor:pointer; border:none; border-radius:5px;">1. LER COLUNAS</button>
    </div>

    <div id="check_area" style="display:none; background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; margin-bottom:20px;">
        <p style="font-size:12px; color:#fbbf24;"><b>⚠️ MARQUE O QUE NÃO PODE APARECER:</b></p>
        <div id="lista_c" style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;"></div>
    </div>

    <div style="display:flex; gap:10px; margin-bottom:20px;">
        <div style="flex:1"><label style="font-size:11px;">LETRA ESCOLA</label><input type="text" id="esc" value="A" style="width:100%; padding:10px; background:#0f172a; border:1px solid #334155; color:white;"></div>
        <div style="flex:1"><label style="font-size:11px;">FILTRO EXCLUSÃO</label><input type="text" id="exc" placeholder="Ex: CANCELADO" style="width:100%; padding:10px; background:#0f172a; border:1px solid #334155; color:white;"></div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <button onclick="gerar('DOCS')" style="padding:15px; background:#4285f4; color:white; font-weight:bold; border:none; border-radius:8px; cursor:pointer;">GOOGLE DOCS</button>
        <button onclick="gerar('PDF')" style="padding:15px; background:#ea4335; color:white; font-weight:bold; border:none; border-radius:8px; cursor:pointer;">PDF (DOWNLOAD)</button>
    </div>
    
    <div id="st" style="margin-top:15px; text-align:center; color:#fbbf24; font-weight:bold;"></div>
</div>

<script>
    async function carregar() {
        const res = await google.colab.kernel.invokeFunction('notebook.obter_colunas', [document.getElementById('link').value, document.getElementById('aba').value], {});
        const dados = res.data['text/plain'].replace(/[\[\]']/g, '').split(',');
        let h = '';
        dados.forEach(item => {
            const partes = item.split('|');
            if(partes.length > 1) {
                h += `<label style="font-size:10px;"><input type="checkbox" class="c-idx" value="${partes[0].trim()}"> ${partes[1].trim()}</label>`;
            }
        });
        document.getElementById('lista_c').innerHTML = h;
        document.getElementById('check_area').style.display = 'block';
    }

    async function gerar(formato) {
        const excluidos = [];
        document.querySelectorAll('.c-idx').forEach(c => { if(c.checked) excluidos.push(c.value); });
        document.getElementById('st').innerHTML = "⏳ Processando...";
        const res = await google.colab.kernel.invokeFunction('notebook.processar_documento', 
            [document.getElementById('link').value, document.getElementById('aba').value, 
             document.getElementById('esc').value, document.getElementById('exc').value, excluidos.join(','), formato], {});
        document.getElementById('st').innerHTML = res.data['text/plain'];
    }
</script>
